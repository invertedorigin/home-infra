apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- namespace.yaml
- pvc.yaml

namespace: plex

helmCharts:
- name: clusterplex
  repo: http://pabloromeo.github.io/clusterplex
  version: v1.1.7
  releaseName: clusterplex
  valuesInLine:
      global:
        sharedStorage:
          transcode:
            storageClass: ceph-filesystem
          media:
            storageClass: ceph-filesystem
          worker:
            storageClass: ceph-block
          additionalMediaVolumes:
            drivers:
              enabled: true
              existingClaim: plex-drivers
              mountPath: /config/Library/Application Support/Plex Media Server/Drivers

            cache:
              enabled: true
              existingClaim: plex-cache
              mountPath: /config/Library/Application Support/Plex Media Server/Cache
      pms:
        config:
          plexClaimToken: claim-FN8gyrYuiG4TE-eCSY_y
          transcodeOperatingMode: remote
        configVolume:
            storageClass: ceph-block
      worker:
        env:
          FFMPEG_HWACCEL: vaapi
        securityContext:
          privileged: true
        resources:
          requests:
            cpu: 2
            memory: 3Gi
            amd.com/gpu: 1
          limits:
            amd.com/gpu: 1
